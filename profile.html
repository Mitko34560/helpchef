<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<link rel="stylesheet" href="style.css">
<script src="auth.js" defer></script>
</head>
<body>

<nav>
<h1>HelpChef</h1>
<a href="index.html">–ù–∞—á–∞–ª–æ</a>
<a href="recipes.html">–†–µ—Ü–µ–ø—Ç–∏</a>
<button onclick="logout()">Logout</button>
</nav>

<div class="profile">
<h2 id="welcome"></h2>
<p id="role"></p>
</div>

<div id="adminPanel" class="admin-panel" style="display:none;">

<h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h3>
<p id="stats"></p>

<h3>üë• –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h3>
<div id="userList"></div>

<h3>üïí –õ–æ–≥ –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è</h3>
<div id="logs"></div>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const user=getCurrentUser();
if(!user) window.location="login.html";

document.getElementById("welcome").innerText="–î–æ–±—Ä–µ –¥–æ—à—ä–ª, "+user.username;
document.getElementById("role").innerText="–†–æ–ª—è: "+user.role;

if(user.role==="admin"){
document.getElementById("adminPanel").style.display="block";
loadAdminData();
}

});

function loadAdminData(){
let users=getUsers();
let blocked=users.filter(u=>u.blocked).length;

document.getElementById("stats").innerText=
"–û–±—â–æ: "+users.length+" | –ë–ª–æ–∫–∏—Ä–∞–Ω–∏: "+blocked;

let container=document.getElementById("userList");
container.innerHTML="";

users.forEach(u=>{
container.innerHTML+=`
<div style="margin:10px 0;">
${u.username} (${u.role})<br>
–†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω: ${u.createdAt || "—Å—Ç–∞—Ä –∞–∫–∞—É–Ω—Ç"}
<button onclick="toggle('${u.username}')">
${u.blocked?"–†–∞–∑–±–ª–æ–∫–∏—Ä–∞–π":"–ë–ª–æ–∫–∏—Ä–∞–π"}
</button>
</div>
`;
});

loadLogs();
}

function toggle(username){
let users=getUsers();
let u=users.find(x=>x.username===username);

u.blocked=!u.blocked;
saveUsers(users);

logAction("–ê–¥–º–∏–Ω –ø—Ä–æ–º–µ–Ω–∏ —Å—Ç–∞—Ç—É—Å –Ω–∞ "+username);

loadAdminData();
}

function loadLogs(){
let logs=JSON.parse(localStorage.getItem("logs")) || [];
let container=document.getElementById("logs");
container.innerHTML="";

logs.slice().reverse().forEach(l=>{
container.innerHTML+=`
<div>
${l.date} - ${l.text}
</div>
`;
});
}
</script>

</body>
</html>
